# 第一章计算机系统概述

## 1.1.1操作系统的概念

>  **什么是操作系统？**

- **操作系统：**
  -  **控制和管理整个计算机系统硬件和软件资源**，
  - **合理的组织调度计算机的工作和资源的分配，以提供给用户和其他软件  方便的接口和环境。**
  - **它是计算机系统中最基本的系统软件。**

>  **操作系统的作用？**

- **控制和管理整个计算机系统硬件和软件资源**，
- **合理的组织调度计算机的工作和资源的分配，以提供给用户和其他软件  方便的接口和环境。**

>  **操作系统的诞生历史是什么？**

####  操作系统作为系统资源的管理者（硬件，软件，文件等），需要提供什么功能？

- 补充知识：进程是一个程序的执行过程，需要将程序放到内存中，才能被CPU处理
- **处理机管理**
- **存储器管理**
- **文件管理**
- **设备管理**
  - 目标：安全高效

#### 操作系统作为用户和计算机硬件之间的接口，要为其用户，应用程序提供简单易用的服务，需要实现什么功能？

- **命令接口**：（允许用户直接使用）
  - **联机**命令接口：用户说一句，系统执行一句
  - **脱机**命令接口（批处理命令接口）：用户说一堆命令，系统执行一堆

- **程序接口**：用户程序间接使用
- **图形用户界面**

#### 操作系统最接近硬件的层次，需要在纯硬件的基础上，实现什么功能？

- **实现对硬件机器的拓展**
- 裸机：没有任何软件支持的计算机。在裸机上安装的操作系统，可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能更强，使用更方便的机器。
- 通常把覆盖了软件的机器称为扩充机器。又称之为虚拟机



## 1.1.2操作系统的特征

- 并发
- 共享     
  - 并发和共享是最基本的特征，二者互为存在条件
- 虚拟
- 异步

##### 并发

- 两个或多个时间在**同一时间间隔内**发生。宏观上是同时的，但微观上是交替发生的。

##### 并行

- 两个或多个事件在**同一时刻同时**发生。

### 什么是 操作系统的并发性？

- 计算机系统同时存在着多个运行着的程序
- 一个单核处理器同一时刻只能执行一个程序，因此操作系统会负责协调多个程序交替执行。

### 什么是共享

- 共享即资源的共享，系统中的资源可供内存中多个并发执行的进程共同使用
  - 互斥共享：一个时间段内允许一个进程访问该资源
  - 同时共享：一个时间段内由多个进程”同时（宏观）“对他们进行访问

### 什么是虚拟？

- 把一个物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，而逻辑上对应物是用户感受到的。

##### 虚拟技术：

- 空分复用技术（虚拟存储器技术）
- 时分复用技术（虚拟处理机）

### 什么是异步？

- 在多道程序环境下，允许多个程序并发执行。但由于资源有限，进程的执行不是一贯到底的。而是不可预知的速度向前推进，这就是进程的异步性。



## 1.1.3操作系统 的发展和分类



![操作系统的发展和分类](F:\计算机基础笔记\操作系统\操作系统的发展和分类.png)

- **手工操作阶段**：
  - 缺点：用户独占主机，人机速度矛盾导致资源利用率极低

- **单道批处理系统**：引入脱机输入/输出，并有 **监督程序**负责控制作业的输入输出。
  - 主要优点：缓解了一定程度的人机速度矛盾，资源利用率有所提升。
  - 主要缺点：内存中只有一道程序运行，只有该程序运行结束之后才能调入下一道程序。CPU有大量的时间未被应用
- **多道批处理系统**：每次往内存中输入多道程序——》并引入了中断技术，由操作系统负责管理这些程序的运行。
  - 主要优点：多道程序并发执行，共享计算机资源。资源利用率大幅提升，CPU和其他资源保持忙碌状态，系统吞吐量大
  - 主要缺点：用户响应时间长，没有人机交互功能
- **分时操作系统**：计算机以**时间片**为单位**轮流为各个用户/作业服务**，各个用户可通过终端与计算机进行交互
  - 主要优点：用户请求可以被及时响应，**解决了人机交互问题**。允许多个用户同时使用一台计算机，并且用户对计算机操作相互独立。
  - 主要缺点：**不能优先处理一些紧急任务**。操作系统是对各个用户/作业完全公平的，循环地为每个用户/作业服务一个时间片，不区分任务的紧急性。
- **实时操作系统**：能够优先响应一些紧急任务，某些紧急任务不需要时间片排队。
  - 在实时操作系统的控制下，计算机接收到外部信号后及时处理。并且要**在严格的时限内处理完事件**。 **特点;及时性和可靠性‘**
  - 硬实时系统：必须在严格的规定时间内完成处理
  - 软实时系统：能接受偶尔违反时间规定
  - 优点：优先处理紧急任务

## 1.1.4操作系统的运行机制

- 指令：CPU能识别的最基本指令 

  - **特权指令**

  - **非特权指令**

    - CPU如何判断当前是否乐于执行特权指令？

       **两种处理器状态**

    - 1.当处理器处于**用户态**时（目态），此时CPU只能执行非特权指令。

    - 2.当处理器处于**核心态**时（管态），特权和非特权指令都可执行。

    - 用**程序状态字寄存器（PSW）**中的某标志位来识别当前用户处理器处于什么状态。0为用户态，1为核心态。

      

      

- **两种程序**：**内核程序**和**应用程序**
  - 内核程序：操作系统的**内核程序是系统的管理者**。既可以**执行特权指令**，也可以**执行非特权指令**，运行在**核心态**
  - 应用程序：为了保证系统能够安全的运行，**普通应用程序只能执行非特权指令**，运行在用户态
- 特权指令只能在核心态下执行
- 内核程序只能在核心态下执行
- 核心态，用户态之间的切换

#### **操作系统的内核**

- 内核功能和非内核功能
- 什么是内核？
  - **内核是计算机上配置的底层软件，是操作系统最基本最核心的部分**。实现操作系统内核功能的那些程序就是内核程序
- **内核功能包括**
  - **时钟管理**
  - **中断处理**
  - **原语**：一**种特别的程序**，是**处于最底层，最接近硬件的部分**，这种程序的运行具有原子性，运行是一气呵成的，不能中断，运行时间短，调用频繁。
  - **进程管理，存储器管理，设备管理等功能**

#### 操作系统的体系结构

- **大内核**：
  - 将操作系统的主要功能模块都作为系统内核，运行在核心态
  - 优点:高性能
  - 缺点：内核代码庞大，结构混乱，难以维护
- **微内核**：
  - 只把最基本的功能保留在内核
  - 优点：内核功能少，结构清晰，方便维护
  - 缺点：需要频繁地在核心态和用户态之间切换，性能低



------

## 1.1.5 中断和异常

- 诞生：为了实现多道程序并发执行而引入的一种技术
- **当中断发生时，CPU立即进入核心态**

#### 中断的概念和作用

- **当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理**
- **对于不同的中断信号，会进行不同的处理**
- 发生中断，就意味着需要操作系统的接入，开展管理工作。由于操作系统的管理工作需要使用特权指令，因此**CPU要从用户态转为核心态**。中断可以使得**CPU从用户态切换为核心态，使得操作系统获得对计算机的控制权。有了中断，才能实现多道程序并发执行。**
  - 用户态，核心态之间的切换时怎么实现的？ 
    -  答：“用户态-->核心态""**是通过中断实现的，并且中断是唯一途径**。
    - **”核心态-->用户态“的切换是通过执行一个特权指令，将程序状态字ＰＳＷ的标志位设置为”用户态“。**

#### 中断的分类

- **内中断**
  - 信号来源：**CPU内部**，与当前执行的指令有关
    - **自愿中断**：指令中断。如系统调用时使用的访管指令（又叫陷入指令）
    - **强迫中断**：硬件故障，软件中断
- **外中断**
  - **信号来源CPU外部**
    - 外设请求
    - 人工干预

#### 外中断的处理过程

- 每条指令执行结束之后，CPU检查是否有外部中断信号
- 若有外部中断信号，则保护被中断进程的CPU环境
- 根据中断信号的类型转入相应的中断处理程序
- 恢复进程的ＣＰＵ环境并退出中断，返回源进程继续往下执行

## 1.1.6 系统调用

#### 什么是系统调用，有何作用

- **系统调用是操作系统提供给应用程序使用的接口**，可以理解为一种可供应用程序**调用的特殊函数**，应用程序应该可以**发出系统调用请求来获得操作系统的服务**
- **作用**：应用程序通过**系统调用**请求操作系统的服务。系统中的各种**共享资源都由操作系统统一掌控**，因此在用户程序中，凡是与资源有关的操作，都必须**通过系统调用的方法向操作系统提出服务请求**。由操作系统代为完成。这样可以保证系统的**稳定性和安全性**。
- **分类**： **设备管理，文件管理，进程控制，进程通信，内存管理**
- 凡是与资源有关的操作，会影响到其他进程的操作，一定需要操作系统介入，既需要通过系统调用实现。

#### 系统调用和库函数的区别

![库函数和系统调用的区别](F:\计算机基础笔记\操作系统\库函数和系统调用的区别.png)

- **库函数是语言或应用程序的一部分，可以运行在用户空间中**。而系统调用是操作系统的一部分，**是内核提供给用户的程序接口，运行在内核空间中**，而且许多的库函数都会使用系统调用实现功能，如在linux下C中的fopen、fclose、fwrite等文件操作函数其底层就是通过open、close、write等系统调用是实现的。**没有使用系统调用的库函数，执行效率通常比系统调用高。因为使用系统调用时，需要通过中断进行上下文的切换以及由用户态向核心态的转移。** 

  

#### 系统调用背后的过程

- **传递系统调用参数->执行陷入指令（在用户态的时候执行）->执行系统调用相应服务程序（核心态）->返回用户程序。**
  - 注意：
    - **陷入指令是在用户态执行的**，执行陷入指令之后**立即引发一个内中断**，从而**CPU进入核心态**
    - 发出**系统调用请求是在用户态**，而对系统调用的相应处理**在核心态下进行**
    - **陷入指令是唯一 一个只能在用户态执行的指令，而不可在核心态执行的指令。**